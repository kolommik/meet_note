"""
Модуль реализует паттерн Стратегия для взаимодействия с разными API чат-моделей.

Определяет абстрактный базовый класс ChatModelStrategy, который служит
общим интерфейсом для всех стратегий чат-моделей. Этот класс требует
реализации основных методов для взаимодействия с API чат-моделей.

Рекомендации по рефакторингу и расширению этого модуля:
1. Следуйте паттерну Стратегия
2. Избегайте связывания стратегий с клиентским кодом
3. Поддерживайте стратегии сфокусированными и связными
4. Рассмотрите возможность извлечения общей функциональности в базовый класс
5. Сохраняйте интерфейс `ChatModelStrategy`

Следование этим рекомендациям сохранит модуль гибким, расширяемым и соответствующим
паттерну Стратегия.
"""

from typing import List, Dict
from abc import ABC, abstractmethod


class ChatModelStrategy(ABC):
    """
    Абстрактный базовый класс для стратегий чат-моделей.

    Этот класс определяет общий интерфейс для всех стратегий чат-моделей
    и требует реализации основных методов для взаимодействия с API чат-моделей.

    Methods
    -------
    get_models()
        Возвращает список доступных моделей для стратегии.
    get_output_max_tokens(model_name)
        Возвращает максимальное количество выходных токенов для указанной модели.
    get_input_tokens()
        Возвращает количество входных токенов, использованных в последнем API-запросе.
    get_output_tokens()
        Возвращает количество выходных токенов, сгенерированных в последнем API-ответе.
    get_cache_create_tokens()
        Возвращает количество токенов, используемых для создания кэша.
    get_cache_read_tokens()
        Возвращает количество токенов, прочитанных из кэша.
    get_full_price()
        Рассчитывает и возвращает полную стоимость на основе входных и выходных токенов.
    send_message(system_prompt, messages, model_name, max_tokens, temperature)
        Отправляет сообщение к API чат-модели и возвращает сгенерированный ответ.
    """

    @abstractmethod
    def get_models(self) -> List[str]:
        """
        Возвращает список доступных моделей для стратегии.

        Returns
        -------
        List[str]
            Список названий доступных моделей.
        """
        pass

    @abstractmethod
    def get_output_max_tokens(self, model_name: str) -> int:
        """
        Возвращает максимальное количество выходных токенов для указанной модели.

        Parameters
        ----------
        model_name : str
            Название модели.

        Returns
        -------
        int
            Максимальное количество выходных токенов для указанной модели.
        """
        pass

    @abstractmethod
    def get_input_tokens(self) -> int:
        """
        Возвращает количество входных токенов, использованных в последнем API-запросе.

        Returns
        -------
        int
            Количество входных токенов, использованных в последнем API-запросе.
        """
        pass

    @abstractmethod
    def get_output_tokens(self) -> int:
        """
        Возвращает количество выходных токенов, сгенерированных в последнем API-ответе.

        Returns
        -------
        int
            Количество выходных токенов, сгенерированных в последнем API-ответе.
        """
        pass

    @abstractmethod
    def get_cache_create_tokens(self) -> int:
        """
        Возвращает количество токенов, используемых для создания кэша в последнем API-запросе.

        Returns
        -------
        int
            Количество токенов создания кэша в последнем API-ответе.
        """
        pass

    @abstractmethod
    def get_cache_read_tokens(self) -> int:
        """
        Возвращает количество токенов, прочитанных из кэша в последнем API-запросе.

        Returns
        -------
        int
            Количество токенов чтения из кэша в последнем API-ответе.
        """
        pass

    @abstractmethod
    def get_full_price(self) -> float:
        """
        Рассчитывает и возвращает полную стоимость на основе входных и выходных токенов.

        Returns
        -------
        float
            Полная стоимость запроса в долларах США.
        """
        pass

    @abstractmethod
    def send_message(
        self,
        system_prompt: str,
        messages: List[Dict[str, str]],
        model_name: str,
        max_tokens: int,
        temperature: float,
    ) -> str:
        """
        Отправляет сообщение к API чат-модели и возвращает сгенерированный ответ.

        Parameters
        ----------
        system_prompt : str
            Системный промпт для контекста разговора.
        messages : List[Dict[str, str]]
            Список сообщений в разговоре, каждое представлено в виде словаря.
        model_name : str
            Название модели для генерации ответа.
        max_tokens : int
            Максимальное количество токенов для генерации в ответе.
        temperature : float
            Температура генерации для контроля случайности сгенерированного ответа.

        Returns
        -------
        str
            Сгенерированный ответ от API чат-модели.
        """
        pass
