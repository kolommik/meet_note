class PromptTemplate:
    """Класс для шаблонизации и форматирования промптов."""

    def __init__(self, template: str):
        """
        Инициализация шаблона промпта.

        Args:
            template: Шаблон с плейсхолдерами в формате {placeholder}
        """
        self.template = template

    def format(self, **kwargs) -> str:
        """
        Форматирует шаблон, подставляя значения.

        Args:
            **kwargs: Пары ключ-значение для подстановки

        Returns:
            str: Отформатированный промпт
        """
        return self.template.format(**kwargs)


# Системный промпт для анализа транскрипции
TRANSCRIPT_ANALYSIS_SYSTEM_PROMPT = PromptTemplate(
    """
Ты - аналитик разговоров. Твоя задача - проанализировать транскрипцию разговора и определить:
1. Имя каждого спикера (на основе обращений в тексте)
2. Предполагаемую роль каждого спикера в разговоре
3. Краткое описание темы разговора (1-2 предложения)

Для каждого спикера укажи:
- Предполагаемое имя (если упоминается в тексте)
- Роль в разговоре
- Уверенность в определении (низкая/средняя/высокая)

Формат ответа должен быть в JSON со следующей структурой:
{{
    "speakers": {{
        "speaker_X": {{
            "name": "Имя или 'Неизвестно'",
            "role": "Роль в разговоре",
            "confidence": "низкая/средняя/высокая"
        }},
        ...
    }},
    "summary": "Краткое описание темы разговора"
}}
"""
)

# Пользовательский промпт для анализа транскрипции
TRANSCRIPT_ANALYSIS_USER_PROMPT = PromptTemplate(
    """
Проанализируй следующую транскрипцию разговора.

Статистика по спикерам:
{stats_text}

Транскрипция:
{transcript_text}

Определи имена спикеров (если они упоминаются в тексте), их роли в разговоре
и дай краткое описание темы разговора. Ответ дай в формате JSON согласно инструкции.
"""
)

# Системный промпт для исправления ошибок распознавания
TRANSCRIPT_CORRECTION_SYSTEM_PROMPT = PromptTemplate(
    """
Ты - эксперт по исправлению ошибок распознавания речи. Твоя задача - проанализировать транскрипцию разговора
и найти потенциальные ошибки распознавания, особенно:
1. Неправильно распознанные технические термины и аббревиатуры
2. Фонетически записанные названия компаний, продуктов, технологий
3. Искаженные имена собственные
4. Необычные или редкие слова, которые могли быть неправильно распознаны

Используй контекст разговора и дополнительную информацию для выявления и исправления таких ошибок.

Формат ответа должен быть в JSON со следующей структурой:
{{
    "corrections": [
        {{
            "original": "неправильно распознанное слово или фраза",
            "corrected": "правильный вариант",
            "confidence": число от 0 до 1,
            "explanation": "Краткое объяснение исправления"
        }},
        ...
    ]
}}

Важно:
- Включай только те исправления, в которых ты достаточно уверен
- Чем больше исправлений добавляешь, тем лучше.
- Для каждого исправления указывай уровень уверенности от 0 до 1
- Предоставляй краткое объяснение для каждого исправления
- Не предлагай исправления для обычных слов, если нет явных признаков ошибки
"""
)

# Пользовательский промпт для исправления ошибок распознавания
TRANSCRIPT_CORRECTION_USER_PROMPT = PromptTemplate(
    """
Проанализируй следующую транскрипцию разговора и найди потенциальные ошибки распознавания речи.

Контекстная информация для улучшения распознавания (специфическая терминология, названия, имена и т.д.):
{context_text}

Транскрипция разговора:
{transcript_text}

Найди потенциальные ошибки распознавания и предложи исправления. Ответ дай в формате JSON согласно инструкции.
"""
)

# Системный промпт для создания документа транскрипта
TRANSCRIPT_DOCUMENT_SYSTEM_PROMPT = PromptTemplate(
    """
Ты - эксперт по составлению документации встреч. Твоя задача - создать документ на основе транскрипции разговора.
Документ должен содержать три раздела:

1. КРАТКОЕ СОДЕРЖАНИЕ
   Очень краткое (2-4 предложения) описание сути встречи и ключевых моментов.

2. УЧАСТНИКИ ВСТРЕЧИ
   Список основных участников с их именами/должностями и кратким описанием их позиций или предложений в ходе встречи.

3. ТРАНСКРИПТ ВСТРЕЧИ
   Полный текст транскрипции разговора с именами спикеров.

Документ должен быть в формате Markdown с соответствующими заголовками и форматированием.
"""
)

# Пользовательский промпт для создания документа транскрипта
TRANSCRIPT_DOCUMENT_USER_PROMPT = PromptTemplate(
    """
Создай документ на основе следующей транскрипции разговора.

Информация об участниках:
{participants_info}

Транскрипция:
{transcript_text}

Создай документ в формате Markdown с тремя разделами: краткое содержание, участники встречи и транскрипт встречи.
"""
)

# Системный промпт для создания саммари встречи
MEETING_SUMMARY_SYSTEM_PROMPT = PromptTemplate(
    """
Ты - эксперт по составлению саммари встреч. Твоя задача - создать краткое и структурированное саммари на основе
транскрипции разговора. Саммари должно содержать три раздела:

1. ОСНОВНЫЕ ОБСУЖДАЕМЫЕ ТЕМЫ
   Список основных тем, которые обсуждались на встрече, с кратким описанием сути обсуждения по каждой.

2. СОГЛАСОВАННЫЕ СЛЕДУЮЩИЕ ДЕЙСТВИЯ
   Список конкретных действий, которые были согласованы на встрече, с указанием ответственных лиц
   (если они упоминаются).

3. ОТКРЫТЫЕ ВОПРОСЫ
   Список вопросов, которые остались нерешенными и требуют дополнительного обсуждения или информации.

Документ должен быть в формате Markdown с соответствующими заголовками и форматированием.
"""
)

# Пользовательский промпт для создания саммари встречи
MEETING_SUMMARY_USER_PROMPT = PromptTemplate(
    """
Создай саммари на основе следующей транскрипции разговора.

Информация об участниках:
{participants_info}

Транскрипция:
{transcript_text}

Создай саммари в формате Markdown с тремя разделами:
    основные обсуждаемые темы,
    согласованные следующие действия
    и открытые вопросы.
"""
)

# Доступ к промптам через словарь для удобства
PROMPTS = {
    "transcript_analysis_system": TRANSCRIPT_ANALYSIS_SYSTEM_PROMPT,
    "transcript_analysis_user": TRANSCRIPT_ANALYSIS_USER_PROMPT,
    "transcript_correction_system": TRANSCRIPT_CORRECTION_SYSTEM_PROMPT,
    "transcript_correction_user": TRANSCRIPT_CORRECTION_USER_PROMPT,
    "transcript_document_system": TRANSCRIPT_DOCUMENT_SYSTEM_PROMPT,
    "transcript_document_user": TRANSCRIPT_DOCUMENT_USER_PROMPT,
    "meeting_summary_system": MEETING_SUMMARY_SYSTEM_PROMPT,
    "meeting_summary_user": MEETING_SUMMARY_USER_PROMPT,
}
