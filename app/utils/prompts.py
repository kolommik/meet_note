class PromptTemplate:
    """Класс для шаблонизации и форматирования промптов."""

    def __init__(self, template: str):
        """
        Инициализация шаблона промпта.

        Args:
            template: Шаблон с плейсхолдерами в формате {placeholder}
        """
        self.template = template

    def format(self, **kwargs) -> str:
        """
        Форматирует шаблон, подставляя значения.

        Args:
            **kwargs: Пары ключ-значение для подстановки

        Returns:
            str: Отформатированный промпт
        """
        return self.template.format(**kwargs)


# Системный промпт для анализа транскрипции
TRANSCRIPT_ANALYSIS_SYSTEM_PROMPT = PromptTemplate(
    """
Ты - аналитик разговоров. Твоя задача - проанализировать транскрипцию разговора и определить:
1. Имя каждого спикера (на основе обращений в тексте)
2. Предполагаемую роль каждого спикера в разговоре
3. Краткое описание темы разговора (1-2 предложения)

Для каждого спикера укажи:
- Предполагаемое имя (если упоминается в тексте)
- Роль в разговоре
- Уверенность в определении (низкая/средняя/высокая)

Формат ответа должен быть в JSON со следующей структурой:
{{
    "speakers": {{
        "speaker_X": {{
            "name": "Имя или 'Неизвестно'",
            "role": "Роль в разговоре",
            "confidence": "низкая/средняя/высокая"
        }},
        ...
    }},
    "summary": "Краткое описание темы разговора"
}}
"""
)

# Пользовательский промпт для анализа транскрипции
TRANSCRIPT_ANALYSIS_USER_PROMPT = PromptTemplate(
    """
Проанализируй следующую транскрипцию разговора.

Статистика по спикерам:
{stats_text}

Транскрипция:
{transcript_text}

Определи имена спикеров (если они упоминаются в тексте), их роли в разговоре
и дай краткое описание темы разговора. Ответ дай в формате JSON согласно инструкции.
"""
)

# Системный промпт для исправления ошибок распознавания (ОБНОВЛЕННЫЙ)
TRANSCRIPT_CORRECTION_SYSTEM_PROMPT = PromptTemplate(
    """
Ты - эксперт по исправлению ошибок распознавания речи в технических разговорах.

Твоя задача - внимательно проанализировать транскрипцию технической встречи или обсуждения и найти все потенциальные
ошибки распознавания, особенно в следующих категориях:

1. Технические термины и специфические понятия, которые могли быть распознаны неверно
2. Аббревиатуры и сокращения (особенно технические, например, API, SDK, UI, ПИПИДЖИ и т.д.)
3. Названия технологий, продуктов, компаний, команд
4. Профессиональный жаргон и специализированные выражения
5. Иностранные слова и заимствования, которые часто используются в технических беседах
6. Фонетически распознанные слова, которые должны иметь конкретное техническое значение
7. Бессмысленные сочетания слов, которые, вероятно, являются ошибками распознавания

Ищи слова и фразы, которые:
- Не имеют смысла в контексте технического обсуждения
- Похожи по звучанию на технические термины
- Выглядят как искаженные аббревиатуры
- Нарушают общепринятую техническую терминологию
- Выглядят странно или неуместно в контексте беседы

Формат ответа должен быть в JSON со следующей структурой:
{{
    "corrections": [
        {{
            "original": "неправильно распознанное слово или фраза",
            "corrected": "правильный вариант",
            "confidence": число от 0 до 1,
            "explanation": "Краткое объяснение исправления с указанием контекста"
        }},
        ...
    ]
}}

Важные указания:
- БУДЬ ВНИМАТЕЛЬНЫМ К ДЕТАЛЯМ и старайся найти все возможные ошибки распознавания
- Особое внимание удели редким техническим терминам, аббревиатурам и названиям
- Для каждого исправления предоставь краткое объяснение с фрагментом контекста
- Даже если сомневаешься, но предполагаешь что есть ошибка - включи её в список с соответствующим уровнем уверенности
- Если для одного исходного текста возможно несколько вариантов исправления, выбери наиболее вероятный
- Обязательно ищи фразы, которые звучат как транслитерация или фонетическая запись английских технических терминов
"""
)

# Пользовательский промпт для исправления ошибок распознавания (ОБНОВЛЕННЫЙ)
TRANSCRIPT_CORRECTION_USER_PROMPT = PromptTemplate(
    """
Проанализируй следующую транскрипцию технической встречи или обсуждения и найди все возможные ошибки автоматического
распознавания речи.

Это транскрипция ТЕХНИЧЕСКОЙ встречи, где обсуждаются специфические термины, технологии, процессы, и используется
профессиональный жаргон. Система распознавания речи могла неправильно распознать многие технические термины
и аббревиатуры.

Контекстная информация для улучшения распознавания (специфическая терминология, названия, имена и т.д.):
{context_text}

Транскрипция разговора:
{transcript_text}

Тщательно проанализируй текст и найди все потенциальные ошибки распознавания, используя свои знания о технических
терминах и контекстную информацию. Обрати особое внимание на странные слова или фразы, которые могут быть неправильно
распознанными техническими терминами.

ВАЖНО: Будь особенно внимателен к непонятным сочетаниям слов, терминам, написанным через пробел, и словам, которые
выглядят как фонетическая запись английских технических терминов.

Ответ дай в формате JSON согласно инструкции. Старайся найти как можно больше потенциальных ошибок распознавания.
"""
)


# Системный промпт для создания саммари встречи
MEETING_SUMMARY_SYSTEM_PROMPT = PromptTemplate(
    """
Ты - эксперт по составлению саммари встреч. Твоя задача - создать краткое и структурированное саммари на основе
транскрипции разговора. Саммари должно содержать три раздела:

1. ОСНОВНЫЕ ОБСУЖДАЕМЫЕ ТЕМЫ
   Список основных тем, которые обсуждались на встрече, с кратким описанием сути обсуждения по каждой.

2. СОГЛАСОВАННЫЕ СЛЕДУЮЩИЕ ДЕЙСТВИЯ
   Список конкретных действий, которые были согласованы на встрече, с указанием ответственных лиц
   (если они упоминаются).

3. ОТКРЫТЫЕ ВОПРОСЫ
   Список вопросов, которые остались нерешенными и требуют дополнительного обсуждения или информации.

Документ должен быть в формате Markdown с соответствующими заголовками и форматированием.
"""
)

# Пользовательский промпт для создания саммари встречи
MEETING_SUMMARY_USER_PROMPT = PromptTemplate(
    """
Создай саммари на основе следующей транскрипции разговора.

Информация об участниках:
{participants_info}

Транскрипция:
{transcript_text}

Создай саммари в формате Markdown с тремя разделами:
    основные обсуждаемые темы,
    согласованные следующие действия
    и открытые вопросы.
"""
)

# Доступ к промптам через словарь для удобства
PROMPTS = {
    "transcript_analysis_system": TRANSCRIPT_ANALYSIS_SYSTEM_PROMPT,
    "transcript_analysis_user": TRANSCRIPT_ANALYSIS_USER_PROMPT,
    "transcript_correction_system": TRANSCRIPT_CORRECTION_SYSTEM_PROMPT,
    "transcript_correction_user": TRANSCRIPT_CORRECTION_USER_PROMPT,
    "meeting_summary_system": MEETING_SUMMARY_SYSTEM_PROMPT,
    "meeting_summary_user": MEETING_SUMMARY_USER_PROMPT,
}
